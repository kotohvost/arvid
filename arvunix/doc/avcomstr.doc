






                                 ПО  "КСИ"
















           КОМПЛЕКС ЗАПИСИ ЦИФРОВОЙ ИНФОРМАЦИИ НА ВИДЕОКАССЕТЫ
                               "АрВид-1000"

                     ИНТЕРПРЕТАТОР КОМАНДНОЙ СТРОКИ
                        РУКОВОДСТВО ПРОГРАММИСТА


























                                  1995
.
                              - 2 -









                          АННОТАЦИЯ



     В настоящем  документе  описывается интерпретатор командной
  строки (ИКС) AVCOMSTR для выполнения  функций  комплекса  "Ар-
  Вид-1000" из программ пользователей и при работе вне поставля-
  емой программы-оболочки AVSHELL.
.
                              - 3 -

                            СОДЕРЖАНИЕ

  1. ЗАПУСК ПРОГРАММНОГО ОБЕСПЕЧЕНИЯ.                          4
  2. ОПИСАНИЕ КОМАНД ИКС.                                      5
  2.1. МОНТИРОВАНИЕ ЛЕНТЫ                                      6
  2.1.1. ИНИЦИАЛИЗАЦИЯ ЛЕНТЫ.                                  6
  2.1.2. ИДЕНТИФИКАЦИЯ ЛЕНТЫ.                                  6
  2.2. РАЗМОНТИРОВАНИЕ ЛЕНТЫ.                                  7
  2.3. РАСПЕЧАТАТЬ СОДЕРЖИМОЕ ДИРЕКТОРИИ.                      7
  2.4. РАСПЕЧАТАТЬ ДЕРЕВО.                                     7
  2.5. ИЗМЕНИТЬ ТЕКУЩИЙ КАТАЛОГ.                               8
  2.6. CОЗДАТЬ КАТАЛОГ.                                        8
  2.7. УДАЛИТЬ КАТАЛОГ                                         8
  2.8. УДАЛИТЬ ФАЙЛ.                                           8
  2.9. СКОПИРОВАТЬ ФАЙЛЫ.                                      8
  2.10. СКОПИРОВАТЬ ДИРЕКТОРИЮ.                                9
  2.11. ПЕРЕМЕСТИТЬ/ПЕРЕИМЕНОВАТЬ ФАЙЛЫ.                       9
  2.12. ПЕРЕМЕСТИТЬ/ПЕРЕИМЕНОВАТЬ ДИРЕКТОРИЮ.                  9
  3. ЖУРНАЛ.                                                  10
  4. СООБЩЕНИЯ ОБ ОШИБКАХ.                                    11

.
                              - 4 -



              1. ЗАПУСК ПРОГРАММНОГО ОБЕСПЕЧЕНИЯ.

     Функции комплекса  "АрВид-1000" могут вызываться в двух ре-
  жимах: через программу-оболочку AVSHELL или через ИКС.

     В зависимости от потребностей пользователя ИКС может запус-
  каться различными способами.  Простейший способ: использование
  готового bat-файла:

                     AVCOMSTR.BAT <ПАРАМЕТР>

     Здесь и далее <ПАРАМЕТР> - это либо команда,  которую необ-
  ходимо  выполнить,  либо  имя  файла-задания с пакетом команд,
  подлежащих последовательному исполнению.  Имени  файла-задания
  предшествует символ @.

     При выполнении  командного  файла будет запущен драйвер AR-
  VIDxx (здесь и далее xx - номер контроллера), затем ИКС, кото-
  рый выполнит заданную команду.  После выполнения команды драй-
  вер выгружается.

     Однако в  большинстве  случаев  невыгодно запускать драйвер
  отдельно для каждого запуска ИКС: часто ИКС должен запускаться
  из программы пользователя, либо ИКС нужно запускать много раз,
  например, при выполнении командного файла. Избежать этого мож-
  но, запустив драйвер ARVIDxx с ключом -y, позволяющим специфи-
  цировать программу,  запускаемую после старта драйвера. Специ-
  фицированная программа,  если не задан полный путь,  ищется  в
  той директории,  в которой находится драйвер, а затем в дирек-
  ториях,  заданных переменной окружения PATH.

     Часто требуется запускать ИКС наряду с другими программами.
  Это удобно  делать из командного процессора или программы-обо-
  лочки. В этом случае удобно запустить командный процессор пос-
  ле запуска драйвера. Для этого введите команду:

                     ARVIDxx -yc:\command.com

  После выдачи   приглашения  вы  сможете  запускать  ИКС  (_AV-
  COMST.EXE) произвольное число раз  без  выгрузки  драйвера  (и
  следовательно без многократной идентификации ленты).

     Кроме того,  запуская командный процессор, Вы можете сразу,
  если необходимо, указать имя bat-файла, при выполнении которо-
  го будет запускаться ИКС:

                ARVIDxx -yc:\command.com mybat.bat

     Если Вы  написали собственную программу,  использующую ИКС,
  то запустить ее можно следующим образом:

                ARVIDxx -yd:\mydir\myprog <парам>

  , где d:\mydir\myprog - спецификация Вашей программы,  а  <па-
  рам> - ее параметры.  При выполнении данной команды будет заг-
  ружен драйвер ARVIDxx,  после чего запустится Ваша программа с

                              - 5 -

  указанными параметрами и драйвер останется загруженным до кон-
  ца ее выполнения.

     При вызове ИКС из программы пользователя для порождения до-
  чернего процесса в терминах MS DOS необходимо выполнить коман-
  ду вызова типа:

                     _AVCOMST.EXE <ПАРАМЕТР>

    где ПАРАМЕТР имеет тот же смысл что и при запуске  программы
  ARVIDxx.

     Ниже приведен пример вызова ИКС на языке С с использованием
  библиотечной функции "spawnl":

  #include <process.h>
  #include <stdio.h>
  main()
  {
  char       *nameProg = "_avcomst.exe"; // имя программы

  // выполняемые команды
  const char *test1    ="mkdir tp:\\temp";
  const char *test2    = "copydir e:\\black tp:\\temp";
  const char *test3    = "copydir e:\\string tp:\\temp";
  const char *test4    = "dir tp:\\/s/o:e/fe:\\comstr\\dt.lst";

  // создание командного файла из команд test1, test2,test3.
  FILE       *f;
  f = fopen("command.tst","wt");
  fprintf(f,"%s\n%s\n%s\n",test1,test2,test3);
  fclose(f);

  // вызов ИКС для выполнения команд файла СOMMAND.TST
  spawnl(P_WAIT,nameProg,nameProg,"@command.tst",NULL);

  // вызов ИКС для выполнения команды test4
  spawnl(P_WAIT,nameProg,nameProg,test4,NULL);

  return 0;
  }

     Созданный этой  программой командный файл COMMAND.TST можно
  было бы выполнить, набрав команду:

                      AVCOMSTR @COMMAND.TST


                     2. ОПИСАНИЕ КОМАНД ИКС.

     Предлагаемый набор команд обеспечивает пользователю удобное
  использование функций комплекса "АрВид-1000". Внешне они напо-
  минают  команды MS DOS.  Главное отличие заключается в следую-
  щем:  когда пользователь формирует команду,  он не знает какой
  буквой обозначить ленту. Поэтому для обозначения ленты исполь-
  зуется обозначение tp:.



                              - 6 -

                     2.1. МОНТИРОВАНИЕ ЛЕНТЫ

     При работе с комплексом каждый раз перед первой операцией с
  лентой необходимо выполнить ее монтирование. Если Вы работаете
  с одной лентой,  Вам не нужно об этом заботиться. Монтирование
  будет выполняться автоматически перед первой командой, в кото-
  рой встретилось обозначение ленты (tp:). При работе с несколь-
  кими лентами,  Вы должны сами управлять процессом монтирования
  лент.

     в ИКС  доступны  два способа монтирования ленты,  каждый из
  которых применяется для своего особого случая.


                   2.1.1. ИНИЦИАЛИЗАЦИЯ ЛЕНТЫ.

     Монтирование ленты инициализацией применяется   при  первом
  использовании новой ленты. При этом создается новое оглавление
  ленты на диске и оно же записывается на ленту вместе с некото-
  рой другой информацией. Инициализация ленты запускается коман-
  дой:

                   INIT NAME LENGTH FORMAT SKIP[/Y]

  ,где
  NAME - уникальное имя ленты (до 8 символов:  латинских букв  и
         цифр,  а также спец. символов, допустимых в именах фай-
         лов (пробелы - не допустимы!));
  LENGTH - длина ленты в минутах;
  FORMAT - формат ленты:
           200 соответствует формату 200КБ/сек,CRC32;
           100        -      формату 100КБ/сек,CRC32;
  SKIP - начальный участок;
  Y - необязательный ключ, по которому предполагается, что лента
      находится в начале,  и инициализация выполняется без пере-
      мотки.  Если ключ не задан,  программа выполняет перемотку
      ленты в начало и ждет подтверждения пользователя для  ини-
      циализации ленты.

     Например, команда:

                     INIT TAPE1 180 200 20 /Y

  выполняет инициализацию ленты без перемотки ее в начало с име-
  нем TAPE1,  длиной 180  минут,  в  формате  200  КБ/сек,CRC32,
  оставив 20 секунд ленты без информации.


                   2.1.2. ИДЕНТИФИКАЦИЯ ЛЕНТЫ.

     Монтирование ленты идентификацией выполняется наиболее час-
  то, в случаях когда лента была проинициализирована ранее и ко-
  пия ее оглавления хранится на диске (см. ARVIDPO.DOC). Для за-
  дания идентификации ленты используется команда:

                              IDENT

  По этой команде ИКС считывает с ленты ее имя (оно содержится в
  любом кадре) и загружает оглавление ленты с диска. После иден-

                              - 7 -

  тификации ленты Вы можете работать с ней,  использовав обозна-
  чение tp:.


                   2.2. РАЗМОНТИРОВАНИЕ ЛЕНТЫ.

     Если Вам необходимо сменить ленту (или Вы больше не  плани-
  руете выполнять операции с лентой),  то прежде чем монтировать
  новую ленту,  размонтируйте старую.  Размонтирование ленты вы-
  полняется командой:

                             DISMOUNT

  При размонтировании фактически выполняются все отложенные опе-
  рации копирования,  затем обновляется оглавление  ленты  (если
  оно корректировалось).  Если при установке комплекса был задан
  переход "STOP->EJECT" и его выполнение разрешено в файле  кон-
  фигурации ARVID.CFG, то он выполняется (лента выбрасывается из
  видеомагнитофона) при размонтировании ленты.


             2.3. РАСПЕЧАТАТЬ СОДЕРЖИМОЕ ДИРЕКТОРИИ.

     Формат команды:

DIR [УСТРОЙСТВО][ПУТЬ][ФАЙЛ][/F<ИМЯ>][/S][/W][/B][A:<TA>][/O:<TO>]

     Ключи:
F - задает имя файла для сохранения распечатки директории;
S - распечатать с поддиректориями;
W - вывод по четыре имени в столбец;
B - вывод только имен файлов;
A - включить в список элементы с атрибутами:
    R - файлы с атрибутом 'только для чтения';
    H - скрытые файлы;
    D - директории;
    S - системные файлы;
    A - архивные файлы;
O - задает тип сортировки:
    N - по именам;
    E - по расширениям;
    S - по размеру;
    D - по дате создания.

     Для распечатки каталога ленты, записанного на диске, вместо
  УСТРОЙСТВО  необходимо  указать  _<ИМЯ_ЛЕНТЫ>:.  В этом случае
  лента не монтируется и вставлять ее в ВМ нет необходимости.


                     2.4. РАСПЕЧАТАТЬ ДЕРЕВО.

     Формат команды:

TREE [УСТРОЙСТВО][ПУТЬ][/F<ИМЯ>][/I]

     Ключи:
F - задает имя файла для сохранения распечатки дерева;
I - включить в распечатку имена файлов.

                              - 8 -


     Для распечатки дерева ленты,  записанного на диске,  вместо
  УСТРОЙСТВО  необходимо  указать  _<ИМЯ_ЛЕНТЫ>:.  В этом случае
  лента не монтируется и вставлять ее в ВМ нет необходимости.


                  2.5. ИЗМЕНИТЬ ТЕКУЩИЙ КАТАЛОГ.

     Формат команды:

CHDIR <ПУТЬ>
     или
CD <ПУТЬ>


                      2.6. CОЗДАТЬ КАТАЛОГ.

     Формат команды:

MKDIR <ПУТЬ>
     или
MD <ПУТЬ>


                       2.7. УДАЛИТЬ КАТАЛОГ

     Формат команды:

RMDIR <ПУТЬ>[/C][/R][/H]
     или
RD <ПУТЬ>[/C][/R][/H]

     Ключи:
C - удалить непустой каталог;
R - удалить в каталоге файлы с атрибутом 'только чтение';
H -  удалить  в  каталоге  файлы  с  атрибутом 'системный' и/или
    'скрытый';


                        2.8. УДАЛИТЬ ФАЙЛ.

     Формат команды:

DEL [УСТРОЙСТВО][ПУТЬ]<ФАЙЛ>[/R][/H]

     Ключ:
R - удалить файл с атрибутом 'только для чтения';
H - удалить файл с атрибутом 'системный' и/или 'скрытый'.


                     2.9. СКОПИРОВАТЬ ФАЙЛЫ.

     Формат команды:

COPY [УСТРОЙСТВО][ПУТЬ]<ФАЙЛ> [УСТРОЙСТВО][ПУТЬ][ФАЙЛ][/N][/O][/R][/H][/A][/C]

     Ключи:
O - обновлять существующие файлы при копировании;

                              - 9 -

R - обновлять файлы с атрибутом 'только для чтения' и 'системный';
N - копировать только новые файлы;
A - копировать с диска только файлы с архивным битом;
C - сбрасывать архивный бит файлов на диске;
H - включить в операцию файлы с атрибутом 'системный' и/или 'скрытый';


                  2.10. СКОПИРОВАТЬ ДИРЕКТОРИЮ.

     Формат команды:

COPYDIR [УСТРОЙСТВО]<ПУТЬ> [УСТРОЙСТВО][ПУТЬ][/O][/I][/N][/R][/H][/A][/C]

     Ключи:
I - копировать директорию без предудаления существующей;
O - обновлять существующие файлы при копировании;
R - обновлять файлы с атрибутом 'только для чтения' и 'системный';
N - копировать только новые файлы;
A - копировать с диска только файлы с архивным битом;
C - сбрасывать архивный бит файлов на диске;
H - включить в операцию файлы с атрибутом 'системный' и/или 'скрытый';

     Копирование директории осуществляется  с  входящими  в  нее
  поддиректориями.


              2.11. ПЕРЕМЕСТИТЬ/ПЕРЕИМЕНОВАТЬ ФАЙЛЫ.

     Формат команды:

MOVE [УСТРОЙСТВО][ПУТЬ]<ФАЙЛ> [УСТРОЙСТВО][ПУТЬ][ФАЙЛ][/O][/R][N][H]

     Ключи:
O - обновлять существующие файлы;
R - обновлять файлы с атрибутом 'только для чтения' и 'системный';
N - переместить только новые файлы.
H - включить в операцию файлы с атрибутом 'системный' и/или 'скрытый';

     Перемещение файлов осуществляется только в пределах  одного
  устройства.


           2.12. ПЕРЕМЕСТИТЬ/ПЕРЕИМЕНОВАТЬ ДИРЕКТОРИЮ.

     Формат команды:

MOVEDIR [УСТРОЙСТВО]<ПУТЬ> [УСТРОЙСТВО][ПУТЬ][/O][/I][N][R][H]

     Ключ:
I - переместить директорию без предудаления существующей;
O - обновлять существующие файлы;
R - обновлять файлы с атрибутом 'только для чтения' и 'системный';
N - переместить только новые файлы.
H - включить в операцию файлы с атрибутом 'системный' и/или 'скрытый';

     Перемещение директории осуществляется  с  входящими  в  нее
  поддиректориями и только в пределах одного устройства.


                              - 10 -


  2.13. РАЗРЕШИТЬ АВТОВЕРИФИКАЦИЮ ПОСЛЕ ЗАПИСИ ДАННЫХ НА ЛЕНТУ.

     Формат команды для автоверификации по CRC.

VERIFY ON

     Формат команды для автоверификации сравнением информации на
  ленте и диске.

VERIFY COMP


  2.14. ЗАПРЕТИТЬ АВТОВЕРИФИКАЦИЮ ПОСЛЕ ЗАПИСИ ДАННЫХ НА ЛЕНТУ.

     Формат команды:

VERIFY OFF



                            3. ЖУРНАЛ.

     Ход выполнения задания записывается ИКС в специальном файле
  с именем AVCOMSTR.LOG. Он формируется в каталоге, определяемом
  переменной окружения AVDIR или в текущем,  если она не опреде-
  лена. Информация  записывается в конец существующего файла AV-
  COMSTR.LOG. А если его нет, то ИКС создает его автоматически.

     В журнал ИКС заносит следующую информацию:
  - время начала и конца сеанса работы;
  - параметры ленты смонтированной для данного сеанса;
  - выполняемые команды;
  - сообщения об успешном выполнении или обнаруженных ошибках;
  - статистика копирования информации.
.
                              - 11 -



                     4. СООБЩЕНИЯ ОБ ОШИБКАХ.

     ИКС завершает работу с кодом возврата. Он информирует поль-
  зователя об успешном выполнении или обнаруженной ошибке.  Ниже
  перечислены возвращаемые интерпретатором коды возврата.

0  - успешное завершение работы;
2  - файл или каталог не найдены;
5  - доступ запрещен. Этот код возврата может возникнуть в следу-
     ющих случаях:
     - создается директория с уже существующим именем (в  команде
       MKDIR);
     - удаляется не пустая директория без  ключа /С  (в  команде
       RMDIR);
     - удаляется без ключа /R файл с атрибутом 'только для  чте-
       ния' (в команде DEL);
     - копируются или перемещаются уже  существующие  файлы  или
       директории без ключа /O (в командах COPY,  COPYDIR, MOVE,
       MOVEDIR);
     - копируются или перемещаются уже существующие файлы c  атри-
       бутом 'только для чтения' без ключа /R (в командах  COPY,
       MOVE);
8  - не хватает свободного места на диске;
12 - недопустимая операция;
15 - устройство отсутствует;
17 - устройство не то же;
35 - файл уже существует;
40 - ошибка ввода/вывода;
49 - при выполнении команды возможна бесконечная рекурсия;
50 - при выполнении команды возможно предудаление копируемой ди-
     ректории;
51 - удаление корневой директории;
52 - копирование(перемещение) в исходный каталог;
55 - неправильное имя;
56 - ошибка открытия временного файла при переходе в режим отло-
     женного копирования;
57 - ошибка записи во временный файл отложенного копирования;
58 - ошибка записи во временный файл оглавления;
59 - не хватает оперативной памяти для выполнения операции;
70 - недопустимая команда;
71 - ошибка в команде;
72 - ошибка в имени файла;
73 - ошибка при монтировании ленты;
74 - драйвер не загружен;
75 - ИКС запущен без параметров;
76 - версии программы и драйвера не совпадают;
77 - несуществующее имя ленты;
78 - монтирование уже выполнено;
79 - монтирование еще не выполнено;
88 - операция прерывалась клавишей TAB;
89 - операция прервана пользователем;
90 - неверная таблица распределения файлов;
91 - прерывание по тайм-ауту;
92 - неверные параметры для программы AVCOPIER;
93 - неудачная запись;
94 - неудачное чтение;

                              - 12 -

95 - не хватает оперативной памяти;
96 - программа AVCOPIER не найдена;
97 - канал выключен;
98 - канал не свободен;
99 - отсутствует блок параметров ленты;
100 - блок параметров ленты уже существует;
101 - отсутствует таблица позиционирования;
102 - таблица позиционирования уже существует;
103 - неизвестный формат ленты;
104 - оглавление ленты не найдено;
105 - недоступный формат для записи;
106 - сектор не найден;
107 - найдена информация, не относящаяся к данной ленте;
108 - операция прервана пользователем;
109 - за предполагаемым концом данных еще есть информация;
110 - при записи данных на ленту не найдено оглавление ленты;
111 - операция прервана пользователем;
112 - операция прервана пользователем;
113 - отсутствует сквозная трансляция при записи;
114 - ошибка обновления оглавления на диске;
115 - ошибка записи во временный файл отложенного копирования;
116 - Для записи данных нет места на ленте.
