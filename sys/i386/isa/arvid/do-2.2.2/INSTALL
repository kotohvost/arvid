Програмный комплекс "АРВИД 1000" предназначен для использования простого
видеомагнитофона, имеющего дистанционное управление (для автоматической
работы комплекса), в качестве ленточного устройства для хранения информации.

=============================================================================

Так как разработчики данного комплекса не пожелали выдать тайны своего
детища, то Я снимаю с себя ответственность возможной поломки оборудования
при использовании данного програмного обеспечения под операционной
системой UNIX.

=============================================================================

Данное програмное обеспечение должно свободно распространяться. Любая продажа
есть нарушение права собственности (или как там его)

=============================================================================

	Для установки драйвера нужно произвести следующие действия:

изменения в /sys/i386/i386/conf.c
Добавляем блоковый девайс (9) и вход с символьного устройства (33)

407,424d406
< /* Arvid 1010 tape card */
< #include "avt.h"
< #if NAVT > 0
< d_open_t	avtopen;
< d_close_t	avtclose;
< d_strategy_t	avtstrategy;
< d_ioctl_t	avtioctl;
< d_dump_t	avtdump;
< d_psize_t	avtsize;
< #else
< #define	avtopen		nxopen
< #define	avtclose	nxclose
< #define	avtstrategy	nxstrategy
< #define	avtioctl	nxioctl
< #define	avtdump		nxdump
< #define	avtsize		zerosize
< #endif
< 
453,454c435,436
< 	{ avtopen,	avtclose,	avtstrategy,	avtioctl,	/*9*/
< 	  avtdump,	avtsize,	B_TAPE },
---
> 	{ lkmopen,	lkmclose,	lkmstrategy,	lkmioctl,	/*9*/
> 	  lkmdump,	lkmsize,	NULL },
1259,1262c1241
< 	{ avtopen,	avtclose,	rawread,	rawwrite,	/*33*/
< 	  avtioctl,	nostop,		nullreset,	nodevtotty,
< 	  seltrue,	nommap,		avtstrategy },
< /*	{ lkmopen,	lkmclose,	lkmread,	lkmwrite,
---
> 	{ lkmopen,	lkmclose,	lkmread,	lkmwrite,	/*33*/
1264c1243
< 	  lkmselect,	lkmmmap,	NULL }, */
---
> 	  lkmselect,	lkmmmap,	NULL },

добавления в /sys/i386/i386/userconfig.c

< {"avt",		"Arvid Tape drive",			0,		CLS_STORAGE},

добавления в /sys/i386/conf/${MYCONFIG}

77,80d123
< 
< # Поддержка арвида - пробный вариант (drq - для 1020)
< device		avt0	at isa? port 0x220 bio irq 11 drq 6 vector avtintr

добавления в /sys/i386/conf/devices.i386

avt	9

добавления в /sys/i386/conf/files.i386

212,213d211
< i386/isa/avt.c		optional	avt	device-driver
< i386/isa/avt_s.s		optional	avt

	Сконфигурируйте каталог для сборки нового kernel. (config ${MYCONFIG})
==============================================================================
			Ниже следующее пока не стоит делать.
/*
	Перепишите фаил avt_rs.o в каталог где будет собираться kernel.
Отредактируйте там же Makefile, на предмет добавления в OBJS файла avt_rs.o
	Этот файл есть скомпилированный исходник для кодирования/декодирования
данных кодом Рида-Соломона, любезно предоставленный мне разработчиками без права
распространения исходного текста. :(
*/
==============================================================================
			А это уже надо делать :)

	Скомпилируйте новый kernel, установите его (make install) из под root,
и перегрузитесь.

Не забудьте создать девайсы в /dev
cd /dev
mknod avt0 b 9 0
mknod ravt0 c 33 0

-------------------------------------------------------------------------------
Для работы 1020 надо прикрутить дифы.
(Я поклал исходники, сами разберетесь :) )
Для 1020 дифов вроде не надо :)

Вроде всё. Если чего вспомню - напишу :))

В 2.2 это все надо делать в исходном тексте драйвера. Как релиз выйдет напишу.
